/* ===== Light Theme (Hygge) ===== */
:root{
    --bg:#faf8f5;--panel:#f5f1eb;--ink:#3d352b;--muted:#8b7355;--ok:#7a9c6c;--bad:#c97d60;--accent:#d4a574
}

/* ===== Dark Theme ===== */
[data-theme="dark"]{
    --bg:#0f172a;--panel:#111827;--ink:#e5e7eb;--muted:#94a3b8;--ok:#10b981;--bad:#ef4444;--accent:#38bdf8
}

*{box-sizing:border-box}
html,body{height:100%}

/* Light theme body */
body{
    margin:0;
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
    background:radial-gradient(1200px 800px at 20% 0%,#ede6d8 0%,var(--bg) 40%,#f5f1eb 100%);
    color:var(--ink);
    display:grid;
    grid-template-rows:auto 1fr auto;
    min-height:100vh;
    gap:12px;
    padding:16px;
    transition:background 0.3s ease,color 0.3s ease;
}

/* Dark theme body */
[data-theme="dark"] body{
    background:radial-gradient(1200px 800px at 20% 0%,#111827 0%,var(--bg) 40%,#0b1022 100%);
}

header,footer{display:flex;align-items:center;justify-content:space-between;position:relative}
#stats{display:flex;align-items:center;gap:12px}
#stats span{margin-right:0;color:var(--muted);font-weight:500}

.icon-btn{
    background:transparent;
    border:1px solid var(--muted);
    border-radius:8px;
    padding:6px 10px;
    font-size:18px;
    cursor:pointer;
    transition:all 0.2s;
    color:var(--ink);
    line-height:1;
}

.icon-btn:hover{
    border-color:var(--accent);
    background:rgba(212,165,116,0.1);
    transform:scale(1.05);
}

.icon-btn.fullscreen-active{
    border-color:var(--accent);
    background:rgba(212,165,116,0.15);
}

[data-theme="dark"] .icon-btn:hover,
[data-theme="dark"] .icon-btn.fullscreen-active{
    background:rgba(56,189,248,0.1);
}

/* Theme toggle */
#themeToggle{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    z-index:10;
}

.theme-switch{
    position:relative;
    display:inline-block;
    width:60px;
    height:30px;
    cursor:pointer;
}

.theme-switch input{
    opacity:0;
    width:0;
    height:0;
}

.slider{
    position:absolute;
    cursor:pointer;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background-color:var(--panel);
    border:1px solid var(--muted);
    transition:.4s;
    border-radius:30px;
}

.slider:before{
    position:absolute;
    content:"";
    height:22px;
    width:22px;
    left:4px;
    bottom:3px;
    background-color:var(--ink);
    transition:.4s;
    border-radius:50%;
    z-index:2;
}

.theme-switch input:checked + .slider{
    background-color:var(--accent);
}

.theme-switch input:checked + .slider:before{
    transform:translateX(30px);
}

/* Light theme slider */
.slider:before{
    background-color:#faf8f5;
}

[data-theme="dark"] .slider:before{
    background-color:#1f2937;
}

/* Sun and Moon Icons */
.sun-icon, .moon-icon{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:14px;
    transition:opacity 0.3s, transform 0.4s;
    z-index:1;
    line-height:1;
}

.sun-icon{
    left:8px;
    opacity:1;
}

.moon-icon{
    right:8px;
    opacity:0;
}

/* Dark mode: show moon, hide sun */
.theme-switch input:checked + .slider .sun-icon{
    opacity:0;
    transform:translateY(-50%) scale(0.5);
}

.theme-switch input:checked + .slider .moon-icon{
    opacity:1;
    transform:translateY(-50%) scale(1);
}

/* Light mode: show sun, hide moon */
.theme-switch input:not(:checked) + .slider .sun-icon{
    opacity:1;
    transform:translateY(-50%) scale(1);
}

.theme-switch input:not(:checked) + .slider .moon-icon{
    opacity:0;
    transform:translateY(-50%) scale(0.5);
}

main{
    max-width:860px;
    margin:0 auto;
    background:rgba(245,241,235,.8);
    border:1px solid #d4c4b0;
    border-radius:16px;
    padding:24px;
    width:100%;
    box-shadow:0 2px 8px rgba(61,53,43,.08);
    transition:background 0.3s ease,border-color 0.3s ease,box-shadow 0.3s ease;
}

[data-theme="dark"] main{
    background:rgba(17,24,39,.6);
    border:1px solid #1f2937;
    box-shadow:none;
}

#controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:12px}
#controls label{display:flex;align-items:center;gap:6px;color:var(--muted);font-size:14px}
#controls input, #controls select, #controls textarea{
    background:#faf8f5;
    color:var(--ink);
    border:1px solid #d4c4b0;
    border-radius:8px;
    padding:8px;
    font-size:14px;
    transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease;
    font-family:inherit;
}

#controls input, #controls select{
    cursor:pointer;
}

#controls select{
    min-width:200px;
    -webkit-appearance:none;
    -moz-appearance:none;
    appearance:none;
    padding-right:8px;
}

#controls textarea{
    width:100%;
    resize:vertical;
    min-height:80px;
    cursor:text;
    font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
}

#customTextContainer{
    width:100%;
    margin-top:8px;
}

#customTextContainer label{
    display:flex;
    flex-direction:column;
    gap:6px;
    width:100%;
}

[data-theme="dark"] #controls input, [data-theme="dark"] #controls select, [data-theme="dark"] #controls textarea{
    background:#0b1329;
    border:1px solid #1f2937;
}

#controls select option{
    background:var(--panel);
    color:var(--ink);
}

#controls select optgroup{
    font-weight:600;
    color:var(--muted);
}

button{
    background:#ede6d8;
    color:var(--ink);
    border:1px solid #d4c4b0;
    border-radius:10px;
    padding:10px 14px;
    cursor:pointer;
    font-size:14px;
    transition:all 0.2s;
}

button:hover{
    border-color:#c9b89b;
    background:#e8ded0;
}

[data-theme="dark"] button{
    background:#111827;
    border:1px solid #1f2937;
}

[data-theme="dark"] button:hover{
    border-color:#334155;
    background:#1a1f2e;
}

button:active{transform:scale(0.98)}

#textToType{
    font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
    font-size:22px;
    line-height:1.8;
    background:#faf8f5;
    border:1px solid #d4c4b0;
    border-radius:12px;
    padding:20px;
    min-height:160px;
    transition:transform .08s,background 0.3s ease,border-color 0.3s ease;
    word-wrap:break-word;
    box-shadow:inset 0 1px 3px rgba(61,53,43,.06);
}

/* When the writing block is used as the editable custom text area */
#textToType.editable{
    background:#fffbe8;
    border:1px dashed rgba(0,0,0,0.08);
    min-height:120px;
    outline:none;
}

/* Placeholder styling when the editable writing block is empty */
#textToType.editable.placeholder{
    color:var(--muted);
}

[data-theme="dark"] #textToType{
    background:#0b1329;
    border:1px solid #1f2937;
    box-shadow:none;
}

.token{opacity:.55;transition:opacity 0.2s}
.token.done{opacity:1}
.token.correct{color:var(--ok)}
.token.wrong{color:var(--bad);text-decoration:underline}

/* Visual styling for newline tokens */
.token.newline{display:block;min-height:18px;background:transparent;border-radius:4px;padding:6px 0;color:var(--muted);font-weight:600}
.token.current.newline{background:rgba(212,165,116,0.08);color:var(--ink)}

/* On-screen keyboard */
.keyboard{margin-top:14px;display:flex;flex-direction:column;gap:8px;user-select:none}
.keyboard.hidden{display:none !important;}

/* Keyboard bar (label + arrow) sits above the keyboard and remains visible when the keyboard is collapsed */
.keyboard-bar{display:flex;align-items:center;gap:10px;margin-top:12px;margin-bottom:8px}
.keyboard-bar .keyboard-label{font-size:18px;color:var(--ink);font-weight:600;letter-spacing:0.2px}
.kb-toggle-btn{padding:0;font-size:18px;line-height:1;border-radius:8px;background:transparent;border:1px solid rgba(0,0,0,0.06);cursor:pointer;display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px}

/* Arrow SVG styling and rotation states */
.icon-arrow{width:14px;height:14px;display:block;fill:currentColor;transition:transform .18s ease;transform-origin:center}
/* Both controls use the same orientation rules: 0deg = down (expanded), 90deg = right (collapsed) */
.kb-toggle-btn .icon-arrow,
.chevron-btn .icon-arrow{
    transform:rotate(0deg);
}
.kb-toggle-btn.collapsed .icon-arrow,
.chevron-btn.collapsed .icon-arrow{
    transform:rotate(90deg);
}

/* Small responsive adjustments */
@media (max-width:640px){
    .keyboard-bar .keyboard-label{font-size:14px}
    .kb-toggle-btn{font-size:16px;padding:6px 8px}
    .chevron-btn{font-size:14px;padding:4px 8px}
}

/* Keep Achievements header and Keyboard label visually consistent on small screens */
@media (max-width:640px){
    #achievements h3{font-size:14px}
}

/* When collapsed, hide the keyboard container but keep the keyboard-bar visible */
.keyboard.collapsed{display:none}
.kb-row{display:flex;gap:8px;justify-content:center}
.key{min-width:36px;min-height:44px;padding:6px 8px;border-radius:8px;background:var(--panel);border:1px solid rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;font-family:ui-monospace,monospace;font-size:15px;color:var(--ink);box-shadow:0 1px 2px rgba(0,0,0,0.03);transition:transform .08s,box-shadow .12s,background .12s}
.key.key-space{min-width:220px;border-radius:10px}
.key.highlight{background:var(--accent);color:var(--panel);transform:translateY(-4px);box-shadow:0 6px 12px rgba(0,0,0,0.08)}
.key.wrong{background:var(--bad);color:#fff;box-shadow:0 6px 10px rgba(0,0,0,0.08)}
.key.weak-1{box-shadow:0 0 0 3px rgba(255,80,80,0.06)}
.key.weak-2{box-shadow:0 0 0 6px rgba(255,80,80,0.09)}
.key.weak-3{box-shadow:0 0 0 10px rgba(255,80,80,0.12)}

@media (max-width:640px){
    .key{min-width:28px;min-height:36px;font-size:13px}
    .key.key-space{min-width:140px}
}

/* Light theme current token */
.token.current{
    background:rgba(212,165,116,.15);
    border-radius:6px;
    padding:2px 1px;
    opacity:1;
    animation:pulse 1.5s ease-in-out infinite;
}

@keyframes pulse{
    0%,100%{background:rgba(212,165,116,.15)}
    50%{background:rgba(212,165,116,.25)}
}

/* Dark theme current token */
[data-theme="dark"] .token.current{
    background:rgba(56,189,248,.12);
    animation:pulseDark 1.5s ease-in-out infinite;
}

@keyframes pulseDark{
    0%,100%{background:rgba(56,189,248,.12)}
    50%{background:rgba(56,189,248,.2)}
}

.shake{animation:shake 0.15s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-3px)}75%{transform:translateX(3px)}}
#hint{margin:10px 0 6px;color:var(--muted);font-size:13px; margin-top:12px; padding-top:12px; border-top:1px solid var(--muted); opacity:0.7;}
#best{margin-top:10px;color:var(--muted);font-size:14px}
#best span{color:var(--accent);font-weight:600}

/* Achievements */
#achievements{
    margin-top:12px;
    padding-top:24px;
    border-top:1px solid var(--muted);
    opacity:0.7;
}

#keyboard{
    margin-bottom:24px;
    opacity:0.7;
}

#achievements h3{display:flex;align-items:center;gap:8px}
#achievements.collapsed #badges{display:none}

.chevron-btn{
    background:transparent;
    border:1px solid var(--muted);
    color:var(--ink);
    border-radius:8px;
    padding:0; /* fixed square for precise alignment */
    width:36px;
    height:36px;
    line-height:1;
    cursor:pointer;
    transition:transform .16s ease, background .16s ease, border-color .16s ease;
    font-size:18px; /* match arrow size with keyboard toggle */
    display:inline-flex;
    align-items:center;
    justify-content:center;
}
.chevron-btn:hover{border-color:var(--accent);background:rgba(212,165,116,0.08);transform:translateY(-1px)}
[data-theme="dark"] .chevron-btn:hover{background:rgba(56,189,248,0.08)}

#achievements h3{
    margin:0 0 16px 0;
    color:var(--ink);
    font-size:18px;
    font-weight:600;
}

#badges{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
    gap:12px;
}

.badge{
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px;
    border-radius:10px;
    border:1px solid var(--muted);
    background:var(--panel);
    transition:all 0.3s ease;
}

.badge.unlocked{
    border-color:var(--accent);
    background:var(--panel);
    opacity:1;
    box-shadow:0 0 0 1px var(--accent);
}

[data-theme="dark"] .badge.unlocked{
    background:rgba(56,189,248,0.1);
}

.badge.unlocked .badge-icon{
    filter:drop-shadow(0 0 4px var(--accent));
}

.badge.locked{
    opacity:0.4;
}

.badge-icon{
    font-size:32px;
    line-height:1;
    flex-shrink:0;
}

.badge-info{
    flex:1;
    min-width:0;
}

.badge-name{
    font-weight:600;
    color:var(--ink);
    font-size:14px;
    margin-bottom:4px;
}

.badge-desc{
    font-size:12px;
    color:var(--muted);
    line-height:1.3;
}

/* Achievement Notification */
.achievement-notification{
    position:fixed;
    top:20px;
    right:20px;
    z-index:1000;
    transform:translateX(400px);
    opacity:0;
    transition:transform 0.3s ease,opacity 0.3s ease;
}

.achievement-notification.show{
    transform:translateX(0);
    opacity:1;
}

.achievement-notification-content{
    display:flex;
    align-items:center;
    gap:16px;
    padding:16px 20px;
    background:var(--panel);
    border:2px solid var(--accent);
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
    min-width:300px;
    max-width:400px;
}

.achievement-icon{
    font-size:48px;
    line-height:1;
    flex-shrink:0;
}

.achievement-text{
    flex:1;
}

.achievement-title{
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:1px;
    color:var(--accent);
    font-weight:600;
    margin-bottom:4px;
}

.achievement-name{
    font-size:18px;
    font-weight:600;
    color:var(--ink);
    margin-bottom:2px;
}

.achievement-desc{
    font-size:13px;
    color:var(--muted);
}

[data-theme="dark"] .achievement-notification-content{
    box-shadow:0 4px 12px rgba(0,0,0,0.5);
}

/* Calendar Modal */
.modal-overlay{
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:rgba(0,0,0,0.5);
    z-index:998;
    opacity:0;
    pointer-events:none;
    transition:opacity 0.3s ease;
}

.modal-overlay.show{
    opacity:1;
    pointer-events:all;
}

.modal{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(0.9);
    z-index:999;
    opacity:0;
    pointer-events:none;
    transition:transform 0.3s ease,opacity 0.3s ease;
    max-width:90vw;
    max-height:90vh;
    width:100%;
    max-width:600px;
}

.modal.show{
    transform:translate(-50%,-50%) scale(1);
    opacity:1;
    pointer-events:all;
}

.modal-content{
    background:var(--panel);
    border:1px solid var(--muted);
    border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,0.3);
    overflow:hidden;
    max-height:90vh;
    display:flex;
    flex-direction:column;
}

.modal-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:20px 24px;
    border-bottom:1px solid var(--muted);
}

.modal-header h2{
    margin:0;
    color:var(--ink);
    font-size:20px;
}

.modal-close{
    background:transparent;
    border:none;
    font-size:28px;
    color:var(--muted);
    cursor:pointer;
    padding:0;
    width:32px;
    height:32px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:6px;
    transition:all 0.2s;
    line-height:1;
}

.modal-close:hover{
    background:var(--bg);
    color:var(--ink);
}

.calendar-container{
    padding:24px;
    overflow-y:auto;
}

#streakDisplay{
    text-align:center;
    font-size:18px;
    font-weight:600;
    color:var(--ink);
    margin-bottom:20px;
    padding:12px;
    background:var(--bg);
    border-radius:10px;
}

#streakCount{
    color:var(--accent);
}

#calendarGrid{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:8px;
}

.calendar-day{
    aspect-ratio:1;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:8px;
    border-radius:8px;
    border:1px solid var(--muted);
    background:var(--bg);
    transition:all 0.2s;
    cursor:pointer;
    position:relative;
}

.calendar-day:hover{
    border-color:var(--accent);
    transform:scale(1.05);
}

.calendar-day.practiced{
    background:var(--ok);
    border-color:var(--ok);
    color:#fff;
}

.calendar-day.today{
    border:2px solid var(--accent);
    font-weight:600;
}

.calendar-day.today.practiced{
    border-color:var(--ok);
    box-shadow:0 0 0 2px var(--accent);
}

.calendar-day-num{
    font-size:16px;
    font-weight:500;
}

.calendar-day-name{
    font-size:10px;
    text-transform:uppercase;
    opacity:0.7;
    margin-top:2px;
}

.calendar-day.practiced .calendar-day-name{
    opacity:0.9;
}

[data-theme="dark"] .modal-content{
    box-shadow:0 8px 24px rgba(0,0,0,0.6);
}

@media (max-width: 768px) {
    .modal{
        max-width:95vw;
    }
    .modal-content{
        max-height:85vh;
    }
    .calendar-container{
        padding:16px;
    }
    #calendarGrid{
        gap:6px;
    }
    .calendar-day{
        padding:6px;
    }
    .calendar-day-num{
        font-size:14px;
    }
    .calendar-day-name{
        font-size:9px;
    }
    
    #textToType{font-size:18px;padding:16px}
    #controls{flex-direction:column;align-items:stretch}
    #controls label{flex-direction:column;align-items:flex-start}
    #controls input, #controls select, #controls textarea{width:100%}
    button{width:100%}
    #themeToggle{position:static;transform:none;margin:10px 0}
    header{flex-direction:column;gap:10px}
    #stats{order:3}
    #badges{grid-template-columns:1fr}
    .achievement-notification{
        right:10px;
        left:10px;
        top:10px;
    }
    .achievement-notification-content{
        min-width:auto;
        max-width:none;
    }
}